name: Deploy Hexo
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: '20'
    - name: Build
      run: |
        rm -rf blog
        npx hexo-cli init blog
        cd blog
        npm install hexo hexo-theme-landscape
        
        # ðŸŽ¯ ä¿®å¤ï¼šæ›¿æ¢çŽ°æœ‰é…ç½®
        sed -i 's|^theme:.*|theme: landscape|' _config.yml
        sed -i 's|^permalink:.*|permalink: :year/:month/:title/|' _config.yml
        
        # åˆ é™¤é»˜è®¤æ–‡ç« 
        rm -f source/_posts/hello-world.md 2>/dev/null
        
        # å¤åˆ¶æ–‡ç« 
        if [ -d "../source/_posts" ]; then
          mkdir -p source/_posts
          cp -r ../source/_posts/* source/_posts/ 2>/dev/null || true
        fi
        
        npx hexo generate
        
        cd public
        git config --global user.name "liudungen"
        git config --global user.email "798695922@qq.com"
        git init
        git add -A
        git commit -m "Deploy $(date +'%Y-%m-%d %H:%M:%S')"
        git push -f "https://liudungen:${{ secrets.HEXO_DEPLOY_TOKEN }}@github.com/liudungen/liudungen.github.io.git" main
